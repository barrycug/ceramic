<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Inspect <%= params[:z] %>/<%= params[:x] %>/<%= params[:y] %></title>
    <style>
      
    </style>
  </head>
  <body>
    
    <article>
      <canvas id="draw" width="512" height="512"></canvas>
    </article>
    
    <article>
      <h1>Tile stats</h1>
    
      <ul>
        <li>Fetch time: <%= "%.3f" % @fetch_time %> seconds</li>
        <li>File size: <%= "%.3f" % (@tile.bytesize.to_f / (1024*1024)) %> MB, <%= "%.3f" % (Zlib.deflate(@tile, 9).bytesize.to_f / (1024*1024)) %> MB deflated</li>
        <li>Feature count: <%= @feature_count %></li>
      </ul>
    </article>
    
    <article>
      <h1>Feature distribution</h1>
      
      <p>Combined keys: <%= @combined_keys.join(", ") %></p>
    
      <ul>
        <% @distribution.each do |(tags, count)| %>
          <li><%= tags %>: <%= count %></li>
        <% end %>
      </ul>
    </article>
    
    <script src="/debug_render.js"></script>
    <script>
    
      var data = <%= @tile %>;
      
      var canvas = document.getElementById("draw");
      var context = canvas.getContext("2d");
      
      // draw the tile data
      
      DebugRender.renderTile(canvas, data);
      
      // draw grid
      
      var i;
      
      context.beginPath();
      
      for (i = 4; i < canvas.width; i += 4) {
        context.moveTo(i - 0.5, 0);
        context.lineTo(i - 0.5, canvas.height);
        context.moveTo(0, i - 0.5);
        context.lineTo(canvas.width, i - 0.5);
      }
      
      context.strokeStyle = "rgba(0, 0, 0, 0.05)";
      context.stroke();
      
    </script>
    
  </body>
</html>
